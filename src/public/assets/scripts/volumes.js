(()=>{"use strict";var e,t={163:()=>{var e=biigle.$require("events"),t=biigle.$require("messages").handleErrorResponse,o=biigle.$require("core.components.loader"),n=biigle.$require("core.mixins.loader"),i=biigle.$require("volumes.mixins.sortComponent"),r=biigle.$require("volumes.stores.sorters");const s=Vue.resource("api/v1/volumes{/volume_id}/color-sort-sequence{/color}");function l(e,t,o,n,i,r,s,l){var c,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=o,u._compiled=!0),n&&(u.functional=!0),r&&(u._scopeId="data-v-"+r),s?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=c):i&&(c=l?function(){i.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(u.functional){u._injectStyles=c;var a=u.render;u.render=function(e,t){return c.call(t),a(e,t)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,c):[c]}return{exports:e,options:u}}const c=l({mixins:[i],components:{loader:o},data:function(){return{title:"Sort images by color",text:"Color",volumeId:null,fetchingColors:!0,colors:[],activeColor:null,cache:{},loadingSequence:!1,computingSequence:!1,newColor:"#000000",canEdit:!1}},computed:{hasColors:function(){return this.colors.length>0},id:function(){return"color-"+this.activeColor},active:function(){return this.activeSorter.startsWith("color-")},canRequestNewColor:function(){return!this.fetchingColors&&!this.loadingSequence&&!this.computingSequence}},methods:{getSequence:function(){var e=this,t=this.activeColor;return this.cache.hasOwnProperty(t)?new Vue.Promise((function(o){o(e.cache[t])})):(this.loadingSequence=!0,s.get({volume_id:this.volumeId,color:t}).then(this.parseResponse).then((function(o){return e.cache[t]=o,o})).finally((function(){return e.loadingSequence=!1})))},parseResponse:function(e){return e.data},initColors:function(e){this.colors=e.data},select:function(e){this.isActive(e)||this.loadingSequence||(this.activeColor=e,this.$emit("select",this))},isActive:function(e){return this.active&&e===this.activeColor},fetchColors:function(){var e=this;s.query({volume_id:this.volumeId}).then(this.initColors).catch(t).finally((function(){return e.fetchingColors=!1}))},pollNewSequence:function(e){var t=this,o=e.body.color;return new Vue.Promise((function(e,n){var i=window.setInterval((function(){s.get({volume_id:t.volumeId,color:o}).then((function(t){t.data&&(window.clearInterval(i),e(t))}),(function(e){window.clearInterval(i),404===e.status&&(e.body.message="Computing the color sort sequence failed. Sorry."),n(e)}))}),2500)}))},requestNewColor:function(){var e=this;this.computingSequence=!0;var o=this.newColor.substr(1);s.save({volume_id:this.volumeId},{color:o}).then(this.pollNewSequence).then((function(t){e.cache[o]=t.data,e.colors.push(o),e.select(o)})).catch(t).finally((function(){return e.computingSequence=!1}))}},created:function(){this.volumeId=biigle.$require("volumes.volumeId"),this.canEdit=biigle.$require("volumes.canEdit")},mounted:function(){e.$once("sidebar.open.sorting",this.fetchColors),this.active&&(this.activeColor=this.activeSorter.substr(this.activeSorter.indexOf("-")+1))}},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("span",{staticClass:"list-group-item color-sort-list-group-item",attrs:{title:"Sort images by color"}},[o("div",{staticClass:"clearfix"},[e.canEdit?o("span",{staticClass:"pull-right"},[o("form",{on:{submit:function(t){return t.preventDefault(),e.requestNewColor.apply(null,arguments)}}},[e.computingSequence?o("loader",{attrs:{active:e.computingSequence}}):e._e(),e._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.newColor,expression:"newColor"}],staticClass:"btn btn-default btn-xs color-picker",attrs:{type:"color",id:"color-sort-color",title:"Choose a new color"},domProps:{value:e.newColor},on:{input:function(t){t.target.composing||(e.newColor=t.target.value)}}}),e._v(" "),o("button",{staticClass:"btn btn-default btn-xs",attrs:{disabled:!e.canRequestNewColor,type:"submit",title:"Request a new color sort sequence for the chosen color"}},[o("span",{staticClass:"fa fa-plus",attrs:{"aria-hidden":"true"}})])],1)]):e._e(),e._v("\n        Color\n        "),e.fetchingColors?o("span",{staticClass:"text-muted"},[e._v("\n            (fetching colors...)\n        ")]):e.hasColors?e._e():o("span",{staticClass:"text-muted"},[e._v("\n            (no colors available)\n        ")])]),e._v(" "),e.hasColors?o("ul",{staticClass:"list-unstyled available-colors-list"},e._l(e.colors,(function(t){return o("li",{staticClass:"available-colors-item",class:{active:e.isActive(t)},style:{"background-color":"#"+t},attrs:{title:"Sort by this color"},on:{click:function(o){return e.select(t)}}})})),0):e._e()])}),[],!1,null,null,null).exports;const u=l({mixins:[n],data:function(){return{sequences:[],volumeId:null}},components:{listItem:{props:["sequence"],computed:{title:function(){return"Delete sequence for color #"+this.color},styleObject:function(){return{"background-color":"#"+this.color}},color:function(){return this.sequence.color}},methods:{remove:function(){this.$emit("remove",this.sequence)}}}},computed:{hasSequences:function(){return this.sequences.length>0}},methods:{handleRemove:function(e){var o=this;!this.loading&&confirm("Do you really want to delete the sequence for color #".concat(e.color,"?"))&&(this.startLoading(),s.delete({volume_id:this.volumeId,color:e.color}).then((function(){return o.sequenceRemoved(e.id)})).catch(t).finally(this.finishLoading))},sequenceRemoved:function(e){this.sequences=this.sequences.filter((function(t){return t.id!==e}))}},created:function(){this.sequences=biigle.$require("volumes.colorSortSequences").map((function(e,t){return{color:e,id:t}})),this.volumeId=biigle.$require("volumes.id")}},undefined,undefined,!1,null,null,null).exports;Array.isArray(r)&&r.push({id:"color",types:["image"],component:c}),biigle.$mount("color-sort-panel",u)},618:()=>{}},o={};function n(e){var i=o[e];if(void 0!==i)return i.exports;var r=o[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,o,i,r)=>{if(!o){var s=1/0;for(a=0;a<e.length;a++){for(var[o,i,r]=e[a],l=!0,c=0;c<o.length;c++)(!1&r||s>=r)&&Object.keys(n.O).every((e=>n.O[e](o[c])))?o.splice(c--,1):(l=!1,r<s&&(s=r));if(l){e.splice(a--,1);var u=i();void 0!==u&&(t=u)}}return t}r=r||0;for(var a=e.length;a>0&&e[a-1][2]>r;a--)e[a]=e[a-1];e[a]=[o,i,r]},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={786:0,155:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[s,l,c]=o,u=0;if(s.some((t=>0!==e[t]))){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(c)var a=c(n)}for(t&&t(o);u<s.length;u++)r=s[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(a)},o=self.webpackChunkbiigle_color_sort=self.webpackChunkbiigle_color_sort||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.O(void 0,[155],(()=>n(163)));var i=n.O(void 0,[155],(()=>n(618)));i=n.O(i)})();