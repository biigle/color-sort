(()=>{"use strict";var e,o={640:()=>{const e=Vue.resource("api/v1/volumes{/volume_id}/color-sort-sequence{/color}");var o=biigle.$require("events"),t=biigle.$require("messages").handleErrorResponse,n=biigle.$require("core.components.loader"),r=biigle.$require("core.mixins.loader"),i=biigle.$require("volumes.mixins.sortComponent"),s=biigle.$require("volumes.stores.sorters");Array.isArray(s)&&s.push({id:"color",types:["image"],component:{template:"#color-sort-template",mixins:[i],components:{loader:n},data:function(){return{title:"Sort images by color",text:"Color",volumeId:null,fetchingColors:!0,colors:[],activeColor:null,cache:{},loadingSequence:!1,computingSequence:!1,newColor:"#000000"}},computed:{hasColors:function(){return this.colors.length>0},id:function(){return"color-"+this.activeColor},active:function(){return this.activeSorter.startsWith("color-")},canRequestNewColor:function(){return!this.fetchingColors&&!this.loadingSequence&&!this.computingSequence}},methods:{getSequence:function(){var o=this,t=this.activeColor;return this.cache.hasOwnProperty(t)?new Vue.Promise((function(e){e(o.cache[t])})):(this.loadingSequence=!0,e.get({volume_id:this.volumeId,color:t}).then(this.parseResponse).then((function(e){return o.cache[t]=e,e})).finally((function(){return o.loadingSequence=!1})))},parseResponse:function(e){return e.data},initColors:function(e){this.colors=e.data},select:function(e){this.isActive(e)||this.loadingSequence||(this.activeColor=e,this.$emit("select",this))},isActive:function(e){return this.active&&e===this.activeColor},fetchColors:function(){var o=this;e.query({volume_id:this.volumeId}).then(this.initColors).catch(t).finally((function(){return o.fetchingColors=!1}))},pollNewSequence:function(o){var t=this,n=o.body.color;return new Vue.Promise((function(o,r){var i=window.setInterval((function(){e.get({volume_id:t.volumeId,color:n}).then((function(e){e.data&&(window.clearInterval(i),o(e))}),(function(e){window.clearInterval(i),404===e.status&&(e.body.message="Computing the color sort sequence failed. Sorry."),r(e)}))}),2500)}))},requestNewColor:function(){var o=this;this.computingSequence=!0;var n=this.newColor.substr(1);e.save({volume_id:this.volumeId},{color:n}).then(this.pollNewSequence).then((function(e){o.cache[n]=e.data,o.colors.push(n),o.select(n)})).catch(t).finally((function(){return o.computingSequence=!1}))}},created:function(){this.volumeId=biigle.$require("volumes.volumeId")},mounted:function(){o.$once("sidebar.open.sorting",this.fetchColors),this.active&&(this.activeColor=this.activeSorter.substr(this.activeSorter.indexOf("-")+1))}}});const c=function(e,o,t,n,r,i,s,c){var u,l="function"==typeof e?e.options:e;if(o&&(l.render=o,l.staticRenderFns=t,l._compiled=!0),n&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),s?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=u):r&&(u=c?function(){r.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:r),u)if(l.functional){l._injectStyles=u;var a=l.render;l.render=function(e,o){return u.call(o),a(e,o)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,u):[u]}return{exports:e,options:l}}({mixins:[r],data:function(){return{sequences:[],volumeId:null}},components:{listItem:{props:["sequence"],computed:{title:function(){return"Delete sequence for color #"+this.color},styleObject:function(){return{"background-color":"#"+this.color}},color:function(){return this.sequence.color}},methods:{remove:function(){this.$emit("remove",this.sequence)}}}},computed:{hasSequences:function(){return this.sequences.length>0}},methods:{handleRemove:function(o){var n=this;!this.loading&&confirm("Do you really want to delete the sequence for color #".concat(o.color,"?"))&&(this.startLoading(),e.delete({volume_id:this.volumeId,color:o.color}).then((function(){return n.sequenceRemoved(o.id)})).catch(t).finally(this.finishLoading))},sequenceRemoved:function(e){this.sequences=this.sequences.filter((function(o){return o.id!==e}))}},created:function(){this.sequences=biigle.$require("volumes.colorSortSequences").map((function(e,o){return{color:e,id:o}})),this.volumeId=biigle.$require("volumes.id")}},undefined,undefined,!1,null,null,null).exports;biigle.$mount("color-sort-panel",c)},992:()=>{}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var i=t[e]={exports:{}};return o[e](i,i.exports,n),i.exports}n.m=o,e=[],n.O=(o,t,r,i)=>{if(!t){var s=1/0;for(l=0;l<e.length;l++){for(var[t,r,i]=e[l],c=!0,u=0;u<t.length;u++)(!1&i||s>=i)&&Object.keys(n.O).every((e=>n.O[e](t[u])))?t.splice(u--,1):(c=!1,i<s&&(s=i));c&&(e.splice(l--,1),o=r())}return o}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[t,r,i]},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={786:0,155:0};n.O.j=o=>0===e[o];var o=(o,t)=>{var r,i,[s,c,u]=t,l=0;for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(u)var a=u(n);for(o&&o(t);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[s[l]]=0;return n.O(a)},t=self.webpackChunkbiigle_color_sort=self.webpackChunkbiigle_color_sort||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})(),n.O(void 0,[155],(()=>n(640)));var r=n.O(void 0,[155],(()=>n(992)));r=n.O(r)})();